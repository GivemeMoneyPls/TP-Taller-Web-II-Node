generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model genero {
  id           Int            @id @default(autoincrement())
  nombre       String         @unique(map: "nombre") @db.VarChar(50)
  juego_genero juego_genero[]
}

model juego {
  id                Int             @id @default(autoincrement())
  titulo            String          @db.VarChar(100)
  fecha_lanzamiento DateTime?       @db.Date
  precio            Decimal         @db.Decimal(10, 2)
  descripcion       String?         @db.Text
  imagen_url        String?         @db.VarChar(255)
  plataforma_id     Int?
  plataforma        plataforma?     @relation(fields: [plataforma_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "juego_ibfk_1")
  juego_genero      juego_genero[]
  usuario_juego     usuario_juego[]
  pedido_juego pedido_juego[]

  @@index([plataforma_id], map: "plataforma_id")
}

model juego_genero {
  juego_id  Int
  genero_id Int
  juego     juego  @relation(fields: [juego_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "juego_genero_ibfk_1")
  genero    genero @relation(fields: [genero_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "juego_genero_ibfk_2")

  @@id([juego_id, genero_id])
  @@index([genero_id], map: "genero_id")
}

model plataforma {
  id     Int     @id @default(autoincrement())
  nombre String  @unique(map: "nombre") @db.VarChar(50)
  juego  juego[]
}

model usuario {
  id            Int             @id @default(autoincrement())
  email         String          @unique(map: "email") @db.VarChar(100)
  contrase_a    String          @map("contraseña") @db.VarChar(255)
  nombre        String          @db.VarChar(50)
  apellido      String          @db.VarChar(50)
  direccion     String?         @db.VarChar(100)
  usuario_juego usuario_juego[]
  pedidos  pedido[]
}

model usuario_juego {
  usuario_id Int
  juego_id   Int
  cantidad   Int?    @default(1)
  usuario    usuario @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "usuario_juego_ibfk_1")
  juego      juego   @relation(fields: [juego_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "usuario_juego_ibfk_2")

  @@id([usuario_id, juego_id])
  @@index([juego_id], map: "juego_id")
}

model pedido {
  id           Int           @id @default(autoincrement())
  usuario_id   Int
  fecha        DateTime      @default(now())
  total        Float         @default(0)
  usuario      usuario       @relation(fields: [usuario_id], references: [id])
  pedido_juego pedido_juego[]
}

model pedido_juego {
  pedido_id      Int
  juego_id       Int
  cantidad       Int     @default(1)
  precio_unitario Float
  pedido         pedido  @relation(fields: [pedido_id], references: [id])
  juego          juego   @relation(fields: [juego_id], references: [id])  // relación con opposite en juego.pedido_juego
  @@id([pedido_id, juego_id])
}